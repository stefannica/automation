- job:
    name: openstack-ardana-pipeline
    project-type: pipeline
    concurrent: true
    workspace: "openstack-ardana-pipeline-$BUILD_ID"
    # the selected node needs the cloud credentials
    node: cloud-ardana-ci
    wrappers:
      - timestamps
      - build-name:
          name: '#${BUILD_NUMBER}: ${ENV,var="job_name"}/${ENV,var="model"}'

      - timeout:
          timeout: 300
          type: no-activity
          abort: true
          write-description: "Job aborted due to 180 minutes of inactivity"

    logrotate:
      numToKeep: 2000
      daysToKeep: 300

    parameters:

      - string:
          name: label
          default: ''
          description: >-
            This label uniquely identifies this job, its workspace and the virtual or hardware environment that it manages.
            A unique label value will be generated if one isn't supplied.

            WARNING: if a virtual environment associated with the supplied label already exists, it will be replaced.

      - choice:
          name: cleanup
          choices:
            -
            - always
            - on success
            - on failure
          description: >-
            Configure the conditions that trigger the virtual environment cleanup.

      - string:
          name: git_automation_repo
          default: https://github.com/SUSE-Cloud/automation.git
          description: >-
            The git automation repository to use

      - string:
          name: git_automation_branch
          default: master
          description: >-
            The git automation branch

      - string:
          name: jenkinsfile_path
          default: jenkins/ci.suse.de/pipelines/openstack-ardana.Jenkinsfile
          description: >-
            The location of the Jenkinsfile defining the pipeline

      - string:
          name: git_input_model_repo
          default: git://git.suse.provo.cloud/ardana/ardana-input-model
          description: >-
            The git repository to use for input models

      - string:
          name: git_input_model_branch
          default: master
          description: >-
            The git repository branch to use for input models

      - string:
          name: git_input_model_path
          default: 2.0/ardana-ci
          description: >-
            Relative path in the input model git repository where the input models are located

      - string:
          name: model
          default: std-min
          description: >-
            The Input Model to use from the input model git repository / branch / path, or the name of the generated
            input model.

      - string:
          name: scenario
          default: ''
          description: >-
            The scenario used to generate the input model

      - choice:
          name: cloudsource
          choices:
            - stagingcloud8
            - develcloud8
            - GM8
            - stagingcloud9
            - develcloud9
          description: >-
            The cloud repository (from provo-clouddata) to be used for testing.
            This value can take the following form:

               stagingcloud<X> (Devel:Cloud:X:Staging)
               develcloud<X> (Devel:Cloud:X)
               GM<X> (official GM)

      - extended-choice:
          name: repositories
          type: multi-select
          value: SLES-Pool,SLES-Updates,SLES-Updates-test,Cloud-Pool,Cloud-Updates,Cloud-Updates-test
          visible-items: 6
          multi-select-delimiter: ','
          default-value: SLES-Pool,SLES-Updates
          description: >-
            Set of zypper repositories (from provo-clouddata) to be configured during installation
            in addition to that indicated by the cloudsource parameter.

      - choice:
          name: update_cloudsource
          choices:
            -
            - stagingcloud8
            - develcloud8
            - GM8
            - stagingcloud9
            - develcloud9
          description: >-
            The cloud media (from provo-clouddata) to be used for update testing. Use a value different than
            cloudsource to enable update testing.

      - extended-choice:
          name: update_repositories
          type: multi-select
          value: SLES-Pool,SLES-Updates,SLES-Updates-test,Cloud-Pool,Cloud-Updates,Cloud-Updates-test
          visible-items: 6
          multi-select-delimiter: ','
          default-value: ''
          description: >-
            Set of repositories to be added after the initial installation and used
            during update testing. Select one or more repositories to enable update testing.

      - choice:
          name: update_method
          choices:
            - update
            - patch
            - dist-upgrade
          description: >-
            The update method used for update testing.

      - string:
          name: tempest_run_filter
          default: ''
          description: >-
            Name of the filter file to use for tempest. Possible values:
            ci, compute, designate, lbaas, network, neutron-api, periodic,
            periodic-virtual, refstack, smoke, swift, tests2skip, tests-ci,
            upgrade-ci or upgrade

      - string:
          name: gerrit_change_ids
          default: ''
          description: >-
            A comma separated list of IDs for changes in
            gerrit.suse.provo.cloud to test.

      - string:
          name: develproject
          default: 'Devel:Cloud:8:Staging'
          description: >-
            Project in IBS to link against when creating a test project for a
            change proposal.

      - string:
          name: homeproject
          default: 'home:opensuseapibmw'
          description: >-
            Project in IBS that will act as the parent project for the newly
            generated test project.

      - string:
          name: repository
          default: 'SLE_12_SP3'
          description: >-
            Name of the repository in IBS against which to build the test packages.

    pipeline-scm:
      scm:
        - git:
            url: ${git_automation_repo}
            branches:
              - ${git_automation_branch}
            browser: auto
      script-path: ${jenkinsfile_path}
      lightweight-checkout: false
