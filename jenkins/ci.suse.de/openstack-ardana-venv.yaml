- job:
    name: openstack-ardana-venv
    project-type: pipeline
    concurrent: true
    wrappers:
      - timestamps
      - build-name:
          name: '#${BUILD_NUMBER}: ${ENV,var="job_name"}/${ENV,var="model"}'

      - timeout:
          timeout: 300
          type: no-activity
          abort: true
          write-description: "Job aborted due to 180 minutes of inactivity"

    logrotate:
      numToKeep: 2000
      daysToKeep: 300

    parameters:
      - string:
          name: git_automation_repo
          default: https://github.com/SUSE-Cloud/automation.git
          description: >-
            The git automation repository to use

      - string:
          name: git_automation_branch
          default: master
          description: >-
            The git automation branch

      - string:
          name: jenkinsfile_path
          default: jenkins/ci.suse.de/pipelines/openstack-ardana-venv.Jenkinsfile
          description: >-
            The location of the Jenkinsfile defining the pipeline

      - string:
          name: git_input_model_repo
          default: git://git.suse.provo.cloud/ardana/ardana-input-model
          description: >-
            The git repository to use for input models

      - string:
          name: git_input_model_branch
          default: master
          description: >-
            The git repository branch to use for input models

      - string:
          name: git_input_model_path
          default: 2.0/ardana-ci
          description: >-
            Relative path in the input model git repository where the input models are located

      - string:
          name: model
          default: std-min
          description: >-
            The Input Model to use from the input model git repository / branch / path

      - string:
          name: scenario
          default: ''
          description: >-
            The scenario used to generate the input model

      - string:
          name: heat_stack_name
          default: ''
          description: >-
            The name of the ECP heat stack created by this job.
            WARNING: if the heat stack with the supplied name exists already, it will be replaced.

      - string:
          name: build_pool_name
          default: ''
          description: >-
            Name of the build resource pool to be used for this job. When
            supplied, the heat stack created by this job will be added to the
            build pool and will be cleaned up automatically when the pool fills up.

      - string:
          name: build_pool_size
          default: '0'
          description: >-
            The maximum number of heat stacks in the build_pool_name build pool
            that can be kept running at any given time. When this number is exceeded,
            older stacks in the pool will be deleted to make place for new ones.

      - string:
          name: reuse_node
          default: ''
          description: >-
            The Jenkins node where this job must run. Used by upstream jobs to
            force a job to use the same node.

      - string:
          name: reuse_workspace
          default: ''
          description: >-
            The Jenkins workspace that this job must reuse. Used by upstream jobs to
            force a job to use the same workspace.

      - string:
          name: job_desc
          default: ''
          description: >-
            The job name suffix set for this job. Used by upstream jobs to indicate
            the global context in which this job is running.

    pipeline-scm:
      scm:
        - git:
            url: ${git_automation_repo}
            branches:
              - ${git_automation_branch}
            browser: auto
      script-path: ${jenkinsfile_path}
      lightweight-checkout: false
